キオ式初音ミク1.51 for Blender 2009/10/10版

お願い

このReadmeには、同時にダウンロードされたデータの使い方について、データを作成した人のお願いが書いてあります。
新たにダウンロードした場合、お願いが変わっていることがありますので、新たにダウンロードしたデータに付属のReadmeを必ず読み直してください。
非営利の使用であり、公序良俗や、関係する方々に迷惑をかけない限り

    データを自分の責任で改造して使ってもかまいません。
    自分で責任をとれる限り、改造したデータであれ、元データであれ再配布してかまいません。
    ただし再配布する場合、必ず同じ条件（非営利・改造可・改造データ再配布可）で、改造の履歴を記述して配布してください。

    暴力自体を目的とする動画、直接的な猥褻行為を目的とする動画、他人を中傷する動画には使用しないでください。




MY WISHES

This readme is only applicable to the modeldata that you downloaded at the same time.
When you download a newer version, you must read carefully the readme distributed with that newer version.

Only for noncommercial use, in respect for the right of all concerned and within the common courtesy, you may

    NOT USE the modeldata to videos with scenes of violence, sexual material or slander (such as R-rated)
    MODIFY the modeldata at your own risk and on your own responsibility
    REDISTRIBUTE the modeldata (modified/original) UNDER THE SAME CONDITIONS of this readme, with the history of modifications, at your own risk and on your own responsibility.

JUST IMAGINE all creators behind the data you downloaded, and let’s enjoy OUR happy creative life.



キオさんが作成した六角大王用の初音ミクモデルをBlenderに移植した物です
使用制限等はキオさんのモデルに準じます
改造・動画作成などは自由にやって構いません

Blenderの基本操作は以下のサイトで習得して下さい
http://wbs.nsf.tc/tutorial/tutorial_blender.html
http://f11.aaa.livedoor.jp/~hige/
http://www.nicovideo.jp/mylist/5515640


■ 使用例

使用例として物を拾うモーションを設定してあります
左側にある再生ボタンを押すと再生されるので
適当に他の事をして60フレームくらいで止めて下さい
重ければBlenderをアクティブにしてEscキー押すと止まります
この時点で60フレーム程度まで物理シミュレーションのキャッシュが作成されます
巻き戻しボタンを押して再度再生ボタンを押すと結構早く再生されます
リアルタイムに再生する方法は・・・ｽｲﾏｾﾝﾖｸﾜｶﾘﾏｾﾝ/ ,' 3 `ヽ


■ オブジェクト一覧

レイヤー毎のオブジェクトの一覧が左上のOutlinerウィンドウに表示されてます
Target_Cameraはカメラのターゲット
Light_なんたらはライト
Bone_なんたらはボーン
Sim_なんたらは物理シミュレーションで使う形状メッシュ
Collision_なんたらは物理シミュレーションで使う衝突判定用メッシュ
Bone_Sim_なんたらはSim_なんたらで使ってるボーン
Deform_なんたらはMeshDeformで使ってる形状メッシュ
Shape_なんたらは操作関連のボーンに適用した元の形状メッシュ
その他は本来の形状メッシュです

このパネルの右側3列に目と矢印と四角いアイコンがありますが
それぞれ表示と選択とレンダリングのOn Offの意味で
クリックすると各オブジェクトの設定を変えられます
レイヤー2の形状オブジェクトはモーションをつける時に選択すると面倒なので
選択できないのがデフォルトになってます
(Faceだけはモーフで表情を設定するので例外で、Subsurfもかけてます)
選択したい時はOutlinerウィンドウで直接クリックするか
その右側にある矢印をクリックすると選択できます


■ レイヤー

3D Viewウィンドウの右下に小さいボタンが沢山並んでるのがレイヤーボタンで
レイヤー1に普段使うボーン、カメラ
レイヤー2に形状メッシュ、ライト
レイヤー3に物理演算用メッシュ
レイヤー4に物理演算用ボーンとMeshDeform用メッシュ
レイヤー5にボーン形状メッシュなど普段使わないような物を置いてます
デフォルトでは1と2のレイヤーが同時表示されていますが
レイヤー3だけの表示にするとリアルタイム並みに表示が速くなります
Shiftを押しながらレイヤーボタンや各数字キーを押すと同時表示できます

レイヤー11、12は背景用などにエッジが出ないようにしてあります
更にレイヤー11はエフェクト用にグロー効果もかけてます
エフェクト用のマテリアルも一応入れてありますが
黒に近づく程グロー効果が効かなくなります
詳しくはレンダーレイヤーの設定とノードを見て下さい
注意点としてアルファが0でもスペキュラを0にしないとエッジが出てしまいます

ボーンのレイヤーは普段は切り替えませんが
レイヤー1に操作関連のボーン、
レイヤー2にボーンヒートウェイティングで適用したボーン
レイヤー3にその他色々普段使わなそうなのを置いてます
レイヤー4は腰の向きの自動補完関連のボーン
レイヤー5は袖関連のボーンです
ボーンがあるレイヤーは●の印があります


■ ボーンの操作

主に操作するのはBone_Bodyオブジェクトのボーンです
選択すると3D Viewの左下に名前が表示されます
赤はIKボーン(IK_なんたら)
青はターゲット(T_なんたら)
緑は回転用(Rot_なんたら)
青緑はFKボーン(FK_なんたら)と接地用など
手関係は黄色にしてます
Gで移動(Grab)、Rで回転(Rotate)、Sで拡大(Scale)ですが
Altを押しながらそれぞれのキーを押すと初期状態に戻せます
時々Gの隣のHを押して選択してる物を非表示設定にしてしまう場合がありますが
これも同じようにAlt+Hで元に戻せます
ターゲットボーンは見た目移動してるけど内部動作は回転の物が多いので
Alt+Gが効かなかったらAlt+Rして下さい

Rを押してそのままZを押すとグローバルのZ軸で回転で
Rの後にZを2回押すとローカルのZ軸で回転できるようになります
IK_Bodyや足のIKボーンなどはローカル軸の回転で調整した方がいいと思います

Iでキーフレームを打てますが、赤く丸いボタンが押されていると自動で打ってくれます
これも同じようにキーを消したいフレームに移動してからAlt+Iで消せますが
キーを打ったボーンを選択してからでないと消せないので
面倒ならAでボーンを全選択してからAlt+I、Availableで消せばいいと思います
Alt+Gなどの初期状態へ戻す操作はこの自動キーフレームは打ってくれないので
戻したら目的の位置に移動させるなり、もう一度Gを押してすぐエンター押すなりして
キーフレームを打たないとレンダリングなどに反映されません

指は各ボーンの先端に各指の第一関節が追従するようにしてあります
ボーンを回転させると指を伸ばしたまま追従し、縮小させるとそれに応じて曲がります
袖と目と目のハイライトと胸はサイズ調整もできます

腕のIKボーンは胸の向きに従属するようになってますが
足下前側にあるスイッチで独立して動くように切り替えられます
手を固定したい時などに適宜切り替えて使うといいと思います
手の回転も前腕の向きに従属しますがこれも同様に切り替えられます
切り替えた後は腕のIKボーンの向きに従属するようになります

腰の向きの自動補完はIK_Bodyの面を基準に体の向きと膝の向きで補完してます
なのでIK_Bodyを適切に回転させないとうまく補完ができません
膝の向きは足のIKボーンの向きと連動してるのでうまく使えば相当楽ができますが
腰の従属独立スイッチの初期値が0.5なのも加えて多少慣れが必要かもしれません
なおIK_BodyのローカルZ軸は回転させても意味はありません

肩周りが変な動きをする場合がありますが回転用ボーンやFKでなんとか修正して下さい
肩はやっぱり難しいです/ ,' 3 `ヽ

BlenderにはPoseライブラリという機能も実装されたので
面倒な指のポーズやよく使うポーズは登録して使った方がいいかもしれません
http://blender.jp/modules/xfsection/article.php?articleid=248
ポーズのコピペや左右へのミラーは3D Viewパネルの右端の3つの矢印ボタンでできます

手に物を持たせたい時には持たせたいオブジェクトを選択して
下のウィンドウでF7を何回か押すと右側にConstraintsのタブが出てくるので
http://bmania.blog70.fc2.com/blog-entry-513.html
を参考に親子関係を作って切り替えるといいと思います
ParentはOB:Bone_BodyのBO:FK_Hand_L(左手)かFK_Hand_R(右手)になります


■ 物理シミュレーション

物理シミュレーションとしてクロスシミュレーションを使っていますが
安定性や速度を考慮した結果、大雑把な形状を使っています
クロスシミュを設定してある簡易メッシュはレイヤー3にある5つ
Sim_Hair（前髪）
Sim_Twintail（ツインテール）
Sim_Tie（ネクタイ）
Sim_Beltparts（ベルト）
Sim_Skirt（スカート）
スカートはMeshDeformも併用してあります
簡易メッシュでのクロスシミュは結構適当で突き抜けたりします・・・/ ,' 3 `ヽ

クロスシミュで動くメッシュも手動のボーンで動かせるようにしてはいます
デフォルトでは非表示になっているBone_Twintailなどですが
クロスシミュの計算をしてから動かすとターゲットなどの位置がズレると思います
手動での微調整は感覚でなんとかして下さい/ ,' 3 `ヽ

クロスシミュを無効にしたい時は
前述のクロスシミュが設定されている各メッシュを選択して
下のウィンドウでF9を押してエディットパネルにすると
Modifiersと書かれてるタブが右側にあるので
Clothの横にある2個のボタンうち、右側のボタンを押してOffにします
マウスを上に乗せるとEnable modifireなんたらと出る十字のグリッド表示のボタンです
有効にしたい時は押してOnにします

クロスシミュの動作が怪しい時はキャッシュを消すと直る場合があります
消す場合は前述のボタンを押してOnOffを切り替えると消えます
結構頻繁におかしくなるので動きが怪しい時はまずこれを試してみて下さい
面倒くさい時は体のボーンをGで動かしてEscでキャンセルしたりすると消えます
他に注意点としてクロスシミュは1フレーム目から計算しないとうまく動きません

クロスシミュのパラメータを変えたい場合は
下のウィンドウでF9を何回か押してPhysics buttonsパネルにすると
Clothタブがあるのでそこで設定します
詳しくは下記のURLで解説されてるので各自調整して下さい/ ,' 3 `ヽ
http://bmania.blog70.fc2.com/blog-entry-539.html
http://bmania.blog70.fc2.com/blog-entry-540.html


■ 体型変化

足下にあるMaster、Size_Head、Size_Bodyのサイズを変えると
それぞれ全体、頭、胴体のサイズが変化します
Xが横幅、Yが長さ、Zが奥行きのサイズです
MasterはXYZ比率を変えるとIKがおかしくなるので同比率にして下さい
拡大は際限なくできると思いますが縮小しすぎると
肩などのQuaternionをかけてるメッシュがおかしくなります/ ,' 3 `ヽ

例えば5頭身くらいに調整したい場合、まずMasterボーンを選択して
Sを押し、そのまま0.6と押しエンターすると全体が0.6倍に縮小されます
次にSize_Headだけを選択し、同じように1.15倍に拡大します
そのまま3D View右下のTransform Propertiesを見ると
ScaleX、Y、Zの値が1.15になっているので直接入力でScaleXだけを1.2に変えます
この時、キーフレームを打たないとレンダリングをした時などに戻ってしまいます
直接入力したボーンは一旦Sを押してエンターで自動キーフレームを打ちましょう
最後にSize_BodyのScaleXだけを直接入力で1.15に変えてキーを打って完成です
低頭身は頭と体の横幅、つまりXのサイズを微妙に膨らませるのがコツだそうです


■ 体型変化を使う際のクロスシミュの注意点

恐らく前述の5頭身サイズがこのクロスシミュ設定の衝突判定の限界だと思います
これ以上小さくすると前髪が降りてこなかったりスカートを突き抜けたりします/ ,' 3 `ヽ
というか初期設定のモーションだとスカート突き抜けてます/ ,' 3 `ヽ

体型変化した際はクロスシミュがおかしくなる場合があるので
その都度キャッシュを消すなどして下さい
(2回くらい消さないといけないかもしれません)
読み込み時に髪が変だったりするのは多分このキャッシュが
現在の体型のサイズと合ってないからだと思われます

サイズのキーフレームを打ってシームレスに体型変化させたい場合もあると思いますが
バグなのか仕様なのかクロスシミュ用メッシュのサイズが変わりません/ ,' 3 `ヽ
体型変化させる場合は最初からサイズを固定して使って下さい


■ GLSL表示の切り替え

Ctrl+Zやライティングの設定をしようとするとメチャメチャ重かったり
最初の読み込みが遅かったりしてGLSLを使いたくない時は
3D Viewウィンドウの下の真ん中あたりに凸凹した球みたいなアイコンがあるので
それでDraw typeをSolidなどに切り替えます
GLSL表示にするにはTexcuredを選択します


■ その他

既知のバグ
・クロスシミュ使用時にツインテールを手動ボーンで手直ししようとすると
変になる事があります/ ,' 3 `ヽ

簡易メッシュでのクロスシミュレーションは
本来のメッシュに普通にボーンとウェイトを適用した後
そのボーンのIK Constraintのターゲットに簡易メッシュのVertexGroupを設定してます
概ねうまく動きますが点へのターゲットなのでネクタイの捻りは再現できません/ ,' 3 `ヽ
スカートの簡易メッシュは前側にネクタイ用衝突判定ポリゴンを作って
その他のポリゴンを揺らしたり結構無茶な事やってます/ ,' 3 `ヽ
以前までツインテールの房の形状が時々ベコベコ変になっていたのですが
クロスシミュ用のボーンをCtrl+Nで原点にZ軸を向けると改善しました
正直意味がよくわかりません/ ,' 3 `ヽ

体型変化はIK ConstraintのChainLenが2以上になりそうなところを
Rootボーンを直前に作ってペアレントを切り、同じ場所にIKのペアレントを作って
なおかつそのペアレントより下のボーンだけをCopy Scaleさせてます
普通に組んで胴体だけをスケールしてもIKが変になるだけでした/ ,' 3 `ヽ

腰の向きの自動補完は向きを示すD_なんたらボーンを体と左右膝の分を用意して
IK_Bodyの面に射影して最終的にD_Weistに合成してます
膝の向きをそのまま取得するのではcycle detectedに引っかかるので
ボーンレイヤー4に足のIKをそのままコピーして別個に取得してます
内部的にはかなり大雑把な動きをしてますがほぼ完璧に動くと思います

ライトのシャドウバッファサイズが2048なのは今使ってるグラボの性能が悪くて
4096にするとGLSL上で影が出なかったからです/ ,' 3 `ヽ
値を高くすればライトとの距離が離れてもくっきりした影ができるハズです

テクスチャは結構適当なので直したい人は各自直して下さい/ ,' 3 `ヽ

質問等がありましたら・・・多分サイトを持っても更新しないと思うので
各自なんとかして下さい/ ,' 3 `ヽ


※ 参考にしたリグ

Bassam Kurdali氏のMancandy
http://freefac.org/
S.C. Moraes Junior, aka MangoJambo氏のReegie
http://mangojambo.wordpress.com/
Khuuyj氏
http://onaka-makkuro.blog.so-net.ne.jp/
bmania氏
http://bmania.blog70.fc2.com/
のリグを参考にさせて頂きました
ありがとうございました


※ 六角からの変換について

六角S6から倍率1のobj形式で書き出してBlenderのobjインポートで
Material分割でClamp Scaleを10、顔だけ1で読み込んでZ軸180度回転してます
目測でズレ補正としてメッシュをLocX:0.001653 LocZ:-0.006096だけ移動させてます
顔のモーフは顔のみ各形状読み込んでDefromed mesh to Rvkスクリプトで処理してます


■ 変更履歴

Ver1.51 → 現在
腰の向きの自動補完実装
従属独立スイッチの実装
Rotボーンの仕様変更
(足のIKボーンの向きに応じて膝の向きも変わるようになりました)
目のボーンの仕様変更
ツインテールの房の形状が時々ベコベコ変になるのを修正
IPO DriverをIpo is connected to Constraint itselfのチェックを外したものに変更
キーライトとバックライトを強さ0.7、減衰なし、ランプバッファのサンプル数を4に変更
(ライトとの距離が離れても暗くならなくなり、明るさ調節がしやすくなりました)
ライトターゲット追加
エフェクト用マテリアル追加
マテリアルの名前変更
レイヤー11をエフェクト用、12を背景用にどちらもエッジが出ないように変更

Ver1.5 → Ver1.51
Limit系ConstraintのFor Transformボタン押下
(これによって見た目以上に内部パラメータが増減していたのを
見た目のまま制限してくれるようになりました)
反射テクスチャが貼れたのでそれに伴ってマテリアル設定調整
(主なマテリアルのスペキュラシェーダをCookTorrからToonにして
ClothesのEmitを0.4→0.3にしただけです)
ペアレントしてなかったメッシュをBone_Bodyにオブジェクトペアレント
(Collision_Bodyだけはキャッシュ消去の都合上やってません)
袖を短くして手を腰の横に持ってきて手首を下げると袖が捻れるという
謎の現象が起こったのでArmのQuaternionを解除/ ,' 3 `ヽ
体型変化実装に伴いボーン構造の見直し
腕のボーン構造の見直し
袖の伸縮と追従の改善
指関連ボーンの調整
MeshDeform用メッシュの調整
カメラターゲットの▲にカメラの▲も回転して追従するように変更
目のハイライトサイズボーン追加
FKボーンの色変更
つま先のターゲットをボーンレイヤー1に移動
腕のIKとT_HeadをT_Bodyの子に変更
クロスシミュのパラメータ調整
Transform Properties表示をデフォルトに変更
ArmとHairのEdgeSplitを非表示に変更
ライトを選択可能に変更、ライトの種類調整
足のRotボーンの調整
Subsurf非表示し忘れてたところがあったのを修正

Ver1.4 → Ver1.5
大きさを1Blender単位が1m程度になるように変更
各オブジェクトをレイヤー分け
Outlinerを表示レイヤーのみに変更
足の接地を改善
FK、Rotボーンの追加
衝突判定用メッシュ追加
スカートのクロスシミュにMeshDeformを併用
カメラターゲット追加
三点照明に変更
GLSL表示をデフォルトに変更
Subsurf非表示をデフォルトに変更
AO非使用をデフォルトに変更
マテリアルのEmit調整
形状メッシュとライトをデフォルトで選択できないように変更
